<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Nightreign Effect Tool</title>

    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link rel="stylesheet" href="../styles/reliquary/layout.css">
    <link rel="stylesheet" href="../styles/reliquary/results.css">
    <link rel="stylesheet" href="../styles/reliquary/components.css">
    <link rel="stylesheet" href="../styles/reliquary/details.css">
    <!-- MUST be last -->
    <link rel="stylesheet" href="../styles/reliquary/overrides.css">

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WT87FT9EYB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      const isProd = location.hostname === 'paraphrazetutorials.github.io' && location.pathname.startsWith('/nightreign-data-tools');
      if (isProd) {
        gtag('config', 'G-WT87FT9EYB');
      }
    </script>
  </head>

  <body>
    <main class="app-shell app-grid">

      <!-- HERO (global renderer) -->
      <header
        id="globalHero"
        class="hero"
        data-hero-image="../Assets/home/Reliquary.png"
        data-hero-h1="The Round Table Codex"
        data-hero-h2="Reliquary"
        data-hero-build="true"
      ></header>

      <!-- NAV (global) -->
      <nav id="globalNav" class="tool-nav" aria-label="Primary navigation"></nav>

      <section class="tool-shell">

        <section class="mode-toggle" aria-label="Reliquary mode">
          <div class="mode-toggle__row">
            <div class="mode-tabs" role="tablist" aria-label="Reliquary mode tabs">
              <button
                id="modeIndividualBtn"
                class="mode-tab is-active"
                type="button"
                role="tab"
                aria-selected="true"
                tabindex="0"
                data-mode="individual"
              >Individual Relics</button>
              <button
                id="modeChaliceBtn"
                class="mode-tab"
                type="button"
                role="tab"
                aria-selected="false"
                tabindex="-1"
                data-mode="chalice"
              >Chalice Builder</button>
            </div>
            <div class="mode-toggle__actions">
              <button id="instructionsBtn" class="utility-ghost" type="button">Instructions</button>
              <button id="disclaimerBtn" class="utility-ghost" type="button">Disclaimer</button>
            </div>
          </div>
          <small class="subtext mode-toggle__hint">Switch between the classic relic view or the new chalice builder prototype.</small>
        </section>

        <!-- UTILITY BAR (Filters + Actions) -->
        <section id="utilityBar" class="utility-bar" aria-label="Reliquary controls">
          <div class="utility-bar__col utility-bar__col--left">
            <div class="utility-stack">
              <div class="utility-inline utility-inline--row utility-inline--fill">
                <label class="utility-field">
                  <select id="relicType">
                    <option value="" selected>-- Relic Type --</option>
                    <option value="Standard">Standard</option>
                    <option value="Depth Of Night">Depth Of Night</option>
                  </select>
                </label>

                <div id="classFilterSlotIndividual" class="utility-field-slot">
                  <label id="classFilterControl" class="utility-field">
                    <select id="classFilter">
                      <option value="" selected>-- Class / All --</option>
                    </select>
                  </label>
                </div>

                <button id="showIllegalBtn" class="utility-toggle" type="button" aria-pressed="false" title="Show Illegal Effect Combinations">
                  <span class="utility-toggle__icon" aria-hidden="true">
                    <svg class="utility-toggle__svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                      <path d="M5.75 5.75L18.25 18.25M12 21C7.029 21 3 16.971 3 12S7.029 3 12 3s9 4.029 9 9-4.029 9-9 9Z" />
                    </svg>
                  </span>
                  <span class="sr-only">Show Illegal Effect Combinations</span>
                </button>

                <div id="illegalPill" class="illegal-pill" role="status" aria-live="polite" hidden>
                  Illegal Effect Combinations Enabled
                </div>

                <div id="startOverSlotIndividual" class="utility-field-slot utility-inline__push">
                  <button id="startOver" class="secondary" type="button">Start Over</button>
                </div>
              </div>
            </div>
          </div>

        </section>

        <!-- Hidden popover sources for Instructions / Disclaimer -->
        <div class="utility-popover-source" id="instructionsPopover" hidden>
          <div class="popover-title">Instructions</div>
          <div class="popover-body">
            <p>
              Select the effects you want on your relic, and the reliquary will tell you how to make it a legal combination&mdash;if it's possible.
            </p>
          </div>
        </div>

        <div class="utility-popover-source" id="disclaimerPopover" hidden>
          <div class="popover-title">Disclaimer</div>
          <div class="popover-body">
            <p>
              This tool is an <strong>unofficial</strong> community helper for planning effect combinations. It does <strong>not</strong> modify your game, connect to your account,
              or guarantee anything about online safety. You are responsible for how you use the information provided here and for any changes you make to your save/data.
            </p>
            <p>
              Compatibility rules and outcomes can change with patches, anticheat updates, and server-side checks.
              If you're not sure whether a change is safe, assume it isn't and keep your relics unedited for online play.
            </p>
            <p class="disclaimer-warning">
              <span style="color: rgba(255, 115, 115, 0.95); font-weight: 800; text-decoration: underline;">
                Please do not play online with illegal relics.
              </span>
            </p>
          </div>
        </div>

        <!-- MAIN GRID -->
        <section class="main-grid">
          <section id="individualMode" class="mode-panel is-active" aria-label="Individual relic builder">
            <section class="right-column">

              <article id="results">
                <div class="panel-header">
                  <h3>Relic Preview</h3>
                  <div class="panel-header__right">
                    <span id="relicValidity" class="validity-badge" hidden>Valid</span>
                    <button id="autoSortBtn" class="auto-sort-btn" type="button" hidden>Auto-Sort</button>
                  </div>
                </div>

                <div class="relic-preview">
                  <div class="relic-frame">
                    <img id="relicImg" alt="Relic preview" />
                    <div id="relicColorControl" class="relic-color-control" hidden>
                      <button
                        id="relicColorChip"
                        class="relic-color-chip"
                        type="button"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                      >
                        <span class="sr-only">Relic color</span>
                      </button>
                      <div id="relicColorMenu" class="relic-color-menu" role="listbox" aria-label="Choose relic color"></div>
                    </div>
                  </div>

                  <div class="relic-effects">
                    <div class="slot-counts">
                      <small class="subtext" id="count1"></small>
                      <small class="subtext" id="count2"></small>
                      <small class="subtext" id="count3"></small>
                    </div>
                    <ul class="chosen-effects" id="chosenList"></ul>
                  </div>
                </div>
              </article>

              <article id="details">
                <div class="panel-header">
                  <h3>Details</h3>
                </div>

                <div id="detailsBody" class="details-body"></div>
              </article>

            </section>
          </section>

          <section id="chaliceMode" class="mode-panel" aria-label="Chalice builder" hidden>
            <article class="chalice-panel">
              <div class="chalice-layout">
                <aside class="chalice-filter" aria-label="Effect pool">
                  <div class="panel-header">
                    <h4>Effect Pool</h4>
                    <div class="panel-header__right">
                      <span class="pill pill--ghost" id="chaliceFilterTotals" aria-live="polite"></span>
                    </div>
                  </div>
                  <div class="chalice-filter__body">
                    <div class="chalice-filter__selectors">
                      <div id="classFilterSlotChalice" class="utility-field-slot"></div>
                      <div id="chalicePickerSlot" class="utility-field-slot">
                        <label id="chalicePickerControl" class="utility-field">
                          <select id="chaliceSelect" aria-label="Chalice"></select>
                        </label>
                      </div>
                    </div>
                    <p class="subtext">Pick effects, then drop them into Standard or Depth slots. Each side allows up to 9 picks, and effects can appear up to three times per side.</p>
                    <div class="chalice-filter__actions">
                      <button id="chaliceAddStandard" class="chalice-filter__btn" type="button">Add Standard Effect</button>
                      <button id="chaliceAddDepth" class="chalice-filter__btn chalice-filter__btn--depth" type="button">Add Depth Effect</button>
                    </div>
                    <div id="startOverSlotChalice" class="utility-field-slot"></div>
                    <small class="subtext chalice-filter__hint">Opens the effect browser so you can search and filter before assigning an effect.</small>
                  </div>
                </aside>

                <section class="chalice-layout__middle" aria-label="Chalice slots">
                  <div class="chalice-grid">
                    <article class="chalice-column" data-side="standard">
                      <div class="panel-header">
                        <div>
                          <h4>Standard / Both Effects</h4>
                          <p class="subtext">Up to 9 picks. You can reuse the same effect up to three times on this side.</p>
                        </div>
                        <span class="pill pill--ghost" id="chaliceStandardCount" aria-live="polite"></span>
                      </div>
                      <ol class="chalice-slot-list" id="chaliceStandardList"></ol>
                    </article>

                    <article class="chalice-column" data-side="depth">
                      <div class="panel-header">
                        <div>
                          <h4>Depth of Night / Both Effects</h4>
                          <p class="subtext">Up to 9 picks. You can reuse the same effect up to three times on this side.</p>
                        </div>
                        <span class="pill pill--ghost" id="chaliceDepthCount" aria-live="polite"></span>
                      </div>
                      <ol class="chalice-slot-list" id="chaliceDepthList"></ol>
                    </article>
                  </div>
                </section>

                <aside class="chalice-layout__results" aria-label="Generated relics">
                  <article class="chalice-results">
                    <div class="panel-header">
                      <h4>Generated Relics</h4>
                      <div class="panel-header__right">
                        <small class="subtext" id="chaliceStatus" aria-live="polite"></small>
                      </div>
                    </div>
                    <div class="chalice-results__grid">
                      <div class="chalice-results__group">
                        <div class="chalice-results__title-row">
                          <div class="chalice-results__title">Standard Relics</div>
                          <div class="chalice-color-dots" id="chaliceStandardColors"></div>
                        </div>
                        <div class="chalice-results__list" id="chaliceResultsStandard"></div>
                      </div>
                      <div class="chalice-results__group">
                        <div class="chalice-results__title-row">
                          <div class="chalice-results__title">Depth of Night Relics</div>
                          <div class="chalice-color-dots" id="chaliceDepthColors"></div>
                        </div>
                        <div class="chalice-results__list" id="chaliceResultsDepth"></div>
                      </div>
                    </div>
                  </article>
                </aside>
              </div>
            </article>
          </section>
        </section>

        <!-- FOOTER (global) -->
        <footer id="globalFooter" class="site-footer"></footer>

      </section>

    </main>
    <script type="module" src="../scripts/hero.js"></script>
    <script type="module" src="./reliquary.js"></script>
    <script type="module" src="../scripts/chrome.js"></script>
</body>
</html>
