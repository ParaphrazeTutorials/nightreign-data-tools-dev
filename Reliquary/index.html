<!doctype html>
<html data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <title>Nightreign Effect Tool</title>

    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link rel="stylesheet" href="../styles/reliquary/layout.css">
    <link rel="stylesheet" href="../styles/reliquary/results.css">
    <link rel="stylesheet" href="../styles/reliquary/components.css">
    <link rel="stylesheet" href="../styles/reliquary/details.css">
    <!-- MUST be last -->
    <link rel="stylesheet" href="../styles/reliquary/overrides.css">

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WT87FT9EYB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      const isProd = location.hostname === 'paraphrazetutorials.github.io' && location.pathname.startsWith('/nightreign-data-tools');
      if (isProd) {
        gtag('config', 'G-WT87FT9EYB');
      }
    </script>
  </head>

  <body>
    <main class="app-shell app-grid">

      <!-- HERO (global renderer) -->
      <header
        id="globalHero"
        class="hero"
        data-hero-image="../Assets/home/Reliquary.png"
        data-hero-h1="The Round Table Codex"
        data-hero-h2="Reliquary"
        data-hero-build="true"
      ></header>

      <!-- NAV (global) -->
      <nav id="globalNav" class="tool-nav" aria-label="Primary navigation"></nav>

      <section class="tool-shell">

        <!-- UTILITY BAR (Filters + Actions) -->
        <section id="utilityBar" class="utility-bar" aria-label="Reliquary controls">
          <div class="utility-bar__col utility-bar__col--left">
            <div id="modeTabsHomeSlot" class="mode-tabs-slot mode-tabs-slot--home">
              <div id="modeSwitchGroup" class="mode-switch-group">
                <div class="mode-tabs mode-tabs--tight" id="modeTabs" role="tablist" aria-label="Reliquary mode tabs">
                  <button
                    id="modeIndividualBtn"
                    class="mode-tab is-active"
                    type="button"
                    role="tab"
                    aria-selected="true"
                    tabindex="0"
                    data-mode="individual"
                  >Individual Relics</button>
                  <button
                    id="modeChaliceBtn"
                    class="mode-tab"
                    type="button"
                    role="tab"
                    aria-selected="false"
                    tabindex="-1"
                    data-mode="chalice"
                  >Chalice Builder</button>
                </div>
                <small class="subtext mode-toggle__hint" data-mode-hint>Switch between the classic relic view or the new chalice builder prototype.</small>
              </div>
            </div>
          </div>

        </section>

        <!-- Hidden popover sources for Instructions / Disclaimer -->
        <div class="utility-popover-source" id="instructionsPopover" hidden>
          <div class="popover-title">Instructions</div>
          <div class="popover-body">
            <p>
              Select the effects you want on your relic, and the reliquary will tell you how to make it a legal combination&mdash;if it's possible.
            </p>
          </div>
        </div>

        <div class="utility-popover-source" id="disclaimerPopover" hidden>
          <div class="popover-title">Disclaimer</div>
          <div class="popover-body">
            <p>
              This tool is an <strong>unofficial</strong> community helper for planning effect combinations. It does <strong>not</strong> modify your game, connect to your account,
              or guarantee anything about online safety. You are responsible for how you use the information provided here and for any changes you make to your save/data.
            </p>
            <p>
              Compatibility rules and outcomes can change with patches, anticheat updates, and server-side checks.
              If you're not sure whether a change is safe, assume it isn't and keep your relics unedited for online play.
            </p>
            <p class="disclaimer-warning">
              <span style="color: rgba(255, 115, 115, 0.95); font-weight: 800; text-decoration: underline;">
                Please do not play online with illegal relics.
              </span>
            </p>
          </div>
        </div>

        <!-- MAIN GRID -->
        <section class="main-grid">
          <section id="individualMode" class="mode-panel is-active" aria-label="Individual relic builder">
            <article class="chalice-panel individual-panel">
              <div class="chalice-layout individual-layout">

                <div class="chalice-layout__main individual-layout__main">
                  <aside class="chalice-filter individual-filter" aria-label="Select effects">
                    <div class="panel-header chalice-filter__header">
                      <div class="chalice-filter__header-left">
                        <div class="chalice-filter__title-row">
                          <h4>Select Effects</h4>
                          <div class="chalice-filter__controls individual-filter__controls">
                            <button
                              id="showIllegalBtn"
                              class="utility-toggle"
                              type="button"
                              aria-pressed="false"
                              data-show-illegal="true"
                            >
                              <span class="utility-toggle__icon" aria-hidden="true">
                                <svg class="utility-toggle__svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                  <path d="M5.75 5.75L18.25 18.25M12 21C7.029 21 3 16.971 3 12S7.029 3 12 3s9 4.029 9 9-4.029 9-9 9Z" />
                                </svg>
                              </span>
                              <span class="sr-only">Show Illegal Effect Combinations</span>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="panel-header__right chalice-filter__header-right individual-filter__header-right">
                        <span class="pill pill--ghost individual-filter__count" aria-live="polite" hidden></span>
                        <div class="chalice-filter__selectors chalice-filter__selectors--inline individual-filter__selectors">
                          <div id="classFilterSlotIndividual" class="utility-field-slot">
                            <label id="classFilterControl" class="utility-field">
                              <select id="classFilter">
                                <option value="" selected>-- Class / All --</option>
                              </select>
                            </label>
                          </div>
                          <div id="relicTypeSlot" class="utility-field-slot">
                            <label id="relicTypeControl" class="utility-field">
                              <select id="relicType">
                                <option value="" selected>-- Relic Type --</option>
                                <option value="Standard">Standard</option>
                                <option value="Depth Of Night">Depth Of Night</option>
                              </select>
                            </label>
                          </div>
                        </div>
                        <button id="instructionsBtn" class="utility-ghost utility-ghost--small" type="button">Instructions</button>
                        <div id="startOverSlotIndividual" class="utility-field-slot utility-field-slot--inline">
                          <button id="startOver" class="secondary" type="button">Start Over</button>
                        </div>
                      </div>
                    </div>

                    <div class="chalice-filter__body individual-filter__body">
                      <div class="individual-filter__hint subtext">Select your relic type and class, then pick effects using the Relic Preview.</div>
                    </div>
                  </aside>

                  <section class="chalice-layout__middle individual-preview" aria-label="Relic preview">
                    <div class="chalice-grid individual-preview-grid">
                      <article id="results" class="chalice-column individual-preview__panel">
                        <div class="panel-header">
                          <h3>Relic Preview</h3>
                          <div class="panel-header__right">
                            <div id="relicProbability" class="relic-probability" role="status" aria-live="polite" hidden>
                              <span id="relicProbabilityValue" class="relic-probability__value">%</span>
                            </div>
                            <span id="relicValidity" class="validity-badge" hidden>Valid</span>
                            <button id="autoSortBtn" class="auto-sort-btn utility-ghost utility-ghost--small" type="button" hidden>Auto-Sort</button>
                          </div>
                        </div>

                        <div class="relic-preview">
                          <div class="relic-frame">
                            <img id="relicImg" alt="Relic preview" />
                            <div id="relicColorControl" class="relic-color-control" hidden>
                              <button
                                id="relicColorChip"
                                class="relic-color-chip"
                                type="button"
                                aria-haspopup="listbox"
                                aria-expanded="false"
                              >
                                <span class="sr-only">Relic color</span>
                              </button>
                              <div id="relicColorMenu" class="relic-color-menu" role="listbox" aria-label="Choose relic color"></div>
                            </div>
                          </div>

                          <div class="relic-effects">
                            <div class="slot-counts">
                              <small class="subtext" id="count1"></small>
                              <small class="subtext" id="count2"></small>
                              <small class="subtext" id="count3"></small>
                            </div>
                            <ul class="chosen-effects" id="chosenList"></ul>
                          </div>
                        </div>
                      </article>
                    </div>
                  </section>
                </div>

                <aside class="chalice-layout__results individual-details" aria-label="Relic details">
                  <article id="details" class="chalice-results individual-details__panel">
                    <div class="panel-header">
                      <h3>Details</h3>
                    </div>

                    <div id="detailsBody" class="details-body"></div>
                  </article>
                </aside>
              </div>
            </article>
          </section>

          <section id="chaliceMode" class="mode-panel" aria-label="Chalice builder" hidden>
            <div class="chalice-mode-tabs">
              <div id="modeTabsChaliceSlot" class="mode-tabs-slot mode-tabs-slot--chalice"></div>
            </div>
            <article class="chalice-panel">
              <div class="chalice-layout" id="chaliceLayout">
                <div class="chalice-layout__main">
                  <aside class="chalice-filter" aria-label="Effect pool">
                    <div class="panel-header chalice-filter__header">
                      <div class="chalice-filter__header-left">
                        <div class="chalice-filter__title-row">
                          <h4>Select Effects</h4>
                          <div class="individual-filter__controls individual-filter__controls--chalice">
                            <button
                              id="showIllegalBtnChalice"
                              class="utility-toggle"
                              type="button"
                              aria-pressed="false"
                              data-show-illegal="true"
                            >
                              <span class="utility-toggle__icon" aria-hidden="true">
                                <svg class="utility-toggle__svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                  <path d="M5.75 5.75L18.25 18.25M12 21C7.029 21 3 16.971 3 12S7.029 3 12 3s9 4.029 9 9-4.029 9-9 9Z" />
                                </svg>
                              </span>
                              <span class="sr-only">Show Illegal Effect Combinations</span>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="panel-header__right chalice-filter__header-right">
                        <div class="chalice-filter__selectors chalice-filter__selectors--inline chalice-filter__selectors--compact">
                          <div id="classFilterSlotChalice" class="utility-field-slot"></div>
                          <div id="chalicePickerSlot" class="utility-field-slot">
                            <label id="chalicePickerControl" class="utility-field">
                              <select id="chaliceSelect" aria-label="Chalice"></select>
                            </label>
                          </div>
                        </div>
                        <span class="pill pill--ghost chalice-filter__count" id="chaliceFilterTotals" aria-live="polite"></span>
                        <button id="instructionsBtnChalice" class="utility-ghost utility-ghost--small" type="button">Instructions</button>
                        <div id="startOverSlotChalice" class="utility-field-slot utility-field-slot--inline"></div>
                      </div>
                    </div>
                    <div class="chalice-filter__body">

                      <div class="chalice-filter__actions">
                        <button id="chaliceAddStandard" class="chalice-filter__btn" type="button">
                          <span class="chalice-filter__btn-label">Add Standard Effect</span>
                          <span class="pill pill--ghost chalice-filter__btn-pill" id="chaliceStandardCount" aria-live="polite"></span>
                        </button>
                        <button id="chaliceAddDepth" class="chalice-filter__btn chalice-filter__btn--depth" type="button">
                          <span class="chalice-filter__btn-label">Add Depth Effect</span>
                          <span class="pill pill--ghost chalice-filter__btn-pill" id="chaliceDepthCount" aria-live="polite"></span>
                        </button>
                      </div>
                    </div>
                  </aside>

                  <section class="chalice-layout__middle" aria-label="Chalice slots">
                    <div class="chalice-grid">
                      <article class="chalice-column" data-side="standard">
                        <div class="panel-header">
                          <div class="panel-header__title-row">
                            <h4>Standard Relics</h4>
                            <div class="chalice-color-dots" id="chaliceStandardColors"></div>
                          </div>
                        </div>
                        <ol class="chalice-slot-list" id="chaliceStandardList"></ol>
                      </article>

                      <article class="chalice-column" data-side="depth">
                        <div class="panel-header">
                          <div class="panel-header__title-row">
                            <h4>Depth of Night Relics</h4>
                            <div class="chalice-color-dots" id="chaliceDepthColors"></div>
                          </div>
                        </div>
                        <ol class="chalice-slot-list" id="chaliceDepthList"></ol>
                      </article>
                    </div>
                  </section>
                </div>

                <aside class="chalice-layout__results" id="chaliceResultsPane" aria-label="Generated relics">
                  <article class="chalice-results">
                    <div class="chalice-results__frame">
                      <div class="details-rail">
                        <button
                          id="chaliceResultsToggle"
                          class="utility-ghost utility-ghost--small chalice-results__toggle"
                          type="button"
                          aria-pressed="false"
                          title="Collapse results panel"
                        >
                          <span class="sr-only">Toggle details panel size</span>
                        </button>
                      </div>

                      <div class="details-shell" id="detailsShell">
                        <div class="panel-header">
                          <h4>Details</h4>
                          <div class="panel-header__right">
                            <button
                              id="chaliceResultsToggleAlt"
                              class="utility-ghost utility-ghost--small chalice-results__toggle chalice-results__toggle--mirror"
                              type="button"
                              aria-pressed="false"
                              title="Collapse details"
                            >
                              <span class="sr-only">Toggle details panel size</span>
                            </button>
                          </div>
                        </div>

                        <div class="chalice-results__content" id="chaliceResultsContent">
                          <section class="stat-overview" id="statOverviewSection" aria-label="Stat overview">
                            <div class="stat-overview__header">
                              <div id="statOverviewPortrait" class="stat-overview__portrait" aria-label="Character portrait placeholder"></div>
                              <div class="stat-overview__identity">
                                <div class="stat-overview__name" id="statOverviewName">Character Name</div>
                                <div class="stat-overview__vitals" aria-label="Character vitals">
                                  <div class="stat-overview__vital">
                                    <span class="stat-overview__vital-icon" aria-hidden="true">HP</span>
                                    <span class="stat-overview__vital-value" id="statOverviewHP">0.00%</span>
                                  </div>
                                  <div class="stat-overview__vital">
                                    <span class="stat-overview__vital-icon" aria-hidden="true">FP</span>
                                    <span class="stat-overview__vital-value" id="statOverviewFP">0.00%</span>
                                  </div>
                                  <div class="stat-overview__vital">
                                    <span class="stat-overview__vital-icon" aria-hidden="true">ST</span>
                                    <span class="stat-overview__vital-value" id="statOverviewST">0.00%</span>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div class="stat-overview__section">
                              <div class="stat-overview__section-title">Attributes</div>
                              <div class="stat-overview__box-grid" id="statOverviewAttributes"></div>
                              <div class="stat-overview__extras" id="statOverviewAttributesExtras"></div>
                            </div>

                            <div class="stat-overview__section">
                              <div class="stat-overview__section-title">Attack</div>
                              <div class="stat-overview__box-grid stat-overview__box-grid--tight" id="statOverviewAttack"></div>
                              <div class="stat-overview__extras" id="statOverviewAttackExtras"></div>
                            </div>

                            <div class="stat-overview__section">
                              <div class="stat-overview__section-title">Defense</div>
                              <div class="stat-overview__box-grid stat-overview__box-grid--tight" id="statOverviewDefense"></div>
                              <div class="stat-overview__extras" id="statOverviewDefenseExtras"></div>
                            </div>

                            <div class="stat-overview__section">
                              <div class="stat-overview__section-title">Utility</div>
                              <div class="stat-overview__extras" id="statOverviewUtilityExtras"></div>
                            </div>

                            <div class="stat-overview__section" id="statOverviewOtherSection">
                              <div class="stat-overview__section-title">Other Effects</div>
                              <ul class="stat-overview__list" id="statOverviewOther"></ul>
                            </div>
                          </section>

                          <div class="chalice-results__takeover-note" id="chaliceResultsTakeoverNote" role="status" hidden>
                            Coming soon: full relic breakdowns in takeover view.
                          </div>
                        </div>
                      </div>
                    </div>
                  </article>
                </aside>
              </div>
            </article>
          </section>
        </section>

        <!-- FOOTER (global) -->
        <footer id="globalFooter" class="site-footer"></footer>

      </section>

    </main>
    <script type="module" src="../scripts/hero.js"></script>
    <script type="module" src="./reliquary.js"></script>
    <script type="module" src="../scripts/chrome.js"></script>
</body>
</html>
